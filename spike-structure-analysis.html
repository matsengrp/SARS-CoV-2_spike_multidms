
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Structural Analysis &#8212; Joint Modeling of SARS-CoV-2 Spike homologs 2023-07-21 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="structural-analysis">
<h1>Structural Analysis<a class="headerlink" href="#structural-analysis" title="Permalink to this heading">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">multidms</span>
<span class="kn">import</span> <span class="nn">pickle</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">env</span> CUDA_VISIBLE_DEVICES=0
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>env: CUDA_VISIBLE_DEVICES=0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">Bio.PDB.PDBParser</span> <span class="kn">import</span> <span class="n">PDBParser</span>
<span class="kn">from</span> <span class="nn">Bio.PDB.PDBList</span> <span class="kn">import</span> <span class="n">PDBList</span>
<span class="kn">from</span> <span class="nn">Bio.PDB.DSSP</span> <span class="kn">import</span> <span class="n">DSSP</span>
<span class="c1"># from statannotations.Annotator import Annotator</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">jax</span>

<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Bbox</span><span class="p">,</span> <span class="n">TransformedBbox</span><span class="p">,</span> <span class="n">blended_transform_factory</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BboxPatch</span><span class="p">,</span> <span class="n">BboxConnector</span><span class="p">,</span> <span class="n">BboxConnectorPatch</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plt.rcParams.keys()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rc_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;legend.frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;font.size&quot;</span> <span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;font.weight&quot;</span> <span class="p">:</span> <span class="s2">&quot;normal&quot;</span>
<span class="p">}</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">rc_kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FIG_OUTDIR</span> <span class="o">=</span> <span class="s2">&quot;../results/manuscript_figures/&quot;</span>
<span class="n">OUTDIR</span> <span class="o">=</span> <span class="s2">&quot;../results/spike_structure_analysis/&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">OUTDIR</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">OUTDIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These models were fit with <a class="reference external" href="https://github.com/matsengrp/multidms/commit/4c88f16a13bc910f30aea0394da70373ea87e8e6">this version</a> of multidms - and thus in the future if the object SHA changes in newer versions pickle binaries will not load unless rolled back to this version</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_set</span> <span class="o">=</span> <span class="s2">&quot;../results/model-ch-sig-I-act-bug-fix&quot;</span>
<span class="n">models</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_set</span><span class="si">}</span><span class="s2">/models.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<span class="n">models</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dataset</th>
      <th>huber_scale_huber</th>
      <th>scale_coeff_lasso_shift</th>
      <th>scale_coeff_ridge_beta</th>
      <th>scale_coeff_ridge_shift</th>
      <th>scale_coeff_ridge_gamma</th>
      <th>scale_coeff_ridge_ch</th>
      <th>data_idx</th>
      <th>epistatic_model</th>
      <th>output_activation</th>
      <th>...</th>
      <th>init_beta_naught</th>
      <th>warmup_beta</th>
      <th>tol</th>
      <th>num_training_steps</th>
      <th>iterations_per_step</th>
      <th>save_model_at</th>
      <th>PRNGKey</th>
      <th>step_loss</th>
      <th>model_30000</th>
      <th>replicate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&lt;multidms.data.Data object at 0x7f79951a0f90&gt;</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0</td>
      <td>Sigmoid</td>
      <td>Identity</td>
      <td>...</td>
      <td>0.0</td>
      <td>False</td>
      <td>0.0001</td>
      <td>30</td>
      <td>1000</td>
      <td>[30000]</td>
      <td>0</td>
      <td>[0.9395107515646639, 0.7935431678910881, 0.740...</td>
      <td>&lt;multidms.model.Model object at 0x7f78628b5e10&gt;</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;multidms.data.Data object at 0x7f798b1e9a90&gt;</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0</td>
      <td>Sigmoid</td>
      <td>Identity</td>
      <td>...</td>
      <td>0.0</td>
      <td>False</td>
      <td>0.0001</td>
      <td>30</td>
      <td>1000</td>
      <td>[30000]</td>
      <td>0</td>
      <td>[0.9531235360436872, 0.7824949636183751, 0.726...</td>
      <td>&lt;multidms.model.Model object at 0x7f78d3f6f410&gt;</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>&lt;multidms.data.Data object at 0x7f79951a0f90&gt;</td>
      <td>1</td>
      <td>0.000001</td>
      <td>0</td>
      <td>0</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0</td>
      <td>Sigmoid</td>
      <td>Identity</td>
      <td>...</td>
      <td>0.0</td>
      <td>False</td>
      <td>0.0001</td>
      <td>30</td>
      <td>1000</td>
      <td>[30000]</td>
      <td>0</td>
      <td>[0.9411085084349253, 0.7951353346883143, 0.738...</td>
      <td>&lt;multidms.model.Model object at 0x7f7862910910&gt;</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>&lt;multidms.data.Data object at 0x7f798b1e9a90&gt;</td>
      <td>1</td>
      <td>0.000001</td>
      <td>0</td>
      <td>0</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0</td>
      <td>Sigmoid</td>
      <td>Identity</td>
      <td>...</td>
      <td>0.0</td>
      <td>False</td>
      <td>0.0001</td>
      <td>30</td>
      <td>1000</td>
      <td>[30000]</td>
      <td>0</td>
      <td>[0.9539601906094175, 0.7860932644613383, 0.723...</td>
      <td>&lt;multidms.model.Model object at 0x7f7862912d10&gt;</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>&lt;multidms.data.Data object at 0x7f79951a0f90&gt;</td>
      <td>1</td>
      <td>0.00001</td>
      <td>0</td>
      <td>0</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0</td>
      <td>Sigmoid</td>
      <td>Identity</td>
      <td>...</td>
      <td>0.0</td>
      <td>False</td>
      <td>0.0001</td>
      <td>30</td>
      <td>1000</td>
      <td>[30000]</td>
      <td>0</td>
      <td>[0.9529916694721674, 0.8109438263982103, 0.749...</td>
      <td>&lt;multidms.model.Model object at 0x7f7862918910&gt;</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 24 columns</p>
</div></div></div>
</div>
<p><strong>Note</strong> When evaluting inferred parameters from these model fits we choose a “times seen threshold” which is essentially the number of genetic backgrounds a mutation must be seen in across all experimental conditions within a single model fit</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seen at least once in each homolog</span>
<span class="n">times_seen_threshold</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The column name in the models df above denoting where the binary model is saved</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;model_30000&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The chosen lasso weight for optimal results</span>
<span class="n">chosen_model_penalty</span> <span class="o">=</span> <span class="mf">5e-5</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Note</strong> We will merge the param results from replicate fits for the chosen model penalty. By choosing <code class="docutils literal notranslate"><span class="pre">how</span> <span class="pre">=</span> <span class="pre">'outer'</span></code> We keep all mutations from both replicates so long as they each satify the times seen threshold in their respective fit. This means there will be some missing data on both sides</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chosen_replicate_models</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;scale_coeff_lasso_shift == @chosen_model_penalty&quot;</span><span class="p">)</span>
<span class="n">mut_df_replicates</span> <span class="o">=</span> <span class="n">multidms</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">combine_replicate_muts</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">row</span><span class="o">.</span><span class="n">replicate</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">chosen_replicate_models</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
    <span class="p">},</span>
    <span class="n">times_seen_threshold</span><span class="o">=</span><span class="n">times_seen_threshold</span><span class="p">,</span>
    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span>
<span class="p">)</span>
<span class="n">mut_df_replicates</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wts</th>
      <th>sites</th>
      <th>muts</th>
      <th>0_beta</th>
      <th>1_beta</th>
      <th>avg_beta</th>
      <th>0_shift_Delta</th>
      <th>1_shift_Delta</th>
      <th>avg_shift_Delta</th>
      <th>0_predicted_func_score</th>
      <th>1_predicted_func_score</th>
      <th>avg_predicted_func_score</th>
      <th>0_shift_Omicron_BA2</th>
      <th>1_shift_Omicron_BA2</th>
      <th>avg_shift_Omicron_BA2</th>
    </tr>
    <tr>
      <th>mutation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A1015D</th>
      <td>A</td>
      <td>1015.0</td>
      <td>D</td>
      <td>-1.257738</td>
      <td>-2.725599</td>
      <td>-1.991668</td>
      <td>0.045677</td>
      <td>0.000000</td>
      <td>0.022839</td>
      <td>-2.786182</td>
      <td>-3.246258</td>
      <td>-3.016220</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>A1015S</th>
      <td>A</td>
      <td>1015.0</td>
      <td>S</td>
      <td>-0.197692</td>
      <td>-0.140867</td>
      <td>-0.169280</td>
      <td>-0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-1.875537</td>
      <td>-1.830467</td>
      <td>-1.853002</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>A1015T</th>
      <td>A</td>
      <td>1015.0</td>
      <td>T</td>
      <td>-1.850089</td>
      <td>-1.733156</td>
      <td>-1.791623</td>
      <td>0.000000</td>
      <td>1.504118</td>
      <td>0.752059</td>
      <td>-3.036877</td>
      <td>-3.023313</td>
      <td>-3.030095</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>A1015V</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-3.782024</td>
      <td>-3.782024</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>-3.334609</td>
      <td>-3.334609</td>
      <td>NaN</td>
      <td>-0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>A1016D</th>
      <td>A</td>
      <td>1016.0</td>
      <td>D</td>
      <td>-0.808871</td>
      <td>NaN</td>
      <td>-0.808871</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>-2.489305</td>
      <td>NaN</td>
      <td>-2.489305</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>ls<span class="w"> </span>../results
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Attic			     naive_approach
manuscript_figures	     raw_data_prep
model-ch-no-c-ref-sig-I-act  reference_comparison
model-ch-sig-I-act	     seed_replicates
model-ch-sig-I-act-1-9	     site_map.csv
model-ch-sig-I-act-bug-fix   spike_structure_analysis
model-ch-sig-I-act-inv-nis
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pdbl</span> <span class="o">=</span> <span class="n">PDBList</span><span class="p">()</span>
<span class="n">pdbl</span><span class="o">.</span><span class="n">retrieve_pdb_file</span><span class="p">(</span><span class="s2">&quot;7tl9&quot;</span><span class="p">,</span> <span class="n">pdir</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s1">/&#39;</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdb&#39;</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s1">/pdb7tl9.ent&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s1">/pdb7tl9.pdb&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Structure exists: &#39;../results/spike_structure_analysis//pdb7tl9.ent&#39; 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;../results/spike_structure_analysis//pdb7tl9.pdb&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parser</span> <span class="o">=</span> <span class="n">PDBParser</span><span class="p">()</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="s2">&quot;7tl9&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s2">/pdb7tl9.ent&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/jgallowa/miniconda3/envs/multidms-dev/lib/python3.11/site-packages/Bio/PDB/StructureBuilder.py:89: PDBConstructionWarning: WARNING: Chain A is discontinuous at line 26146.
  warnings.warn(
/home/jgallowa/miniconda3/envs/multidms-dev/lib/python3.11/site-packages/Bio/PDB/StructureBuilder.py:89: PDBConstructionWarning: WARNING: Chain B is discontinuous at line 26272.
  warnings.warn(
/home/jgallowa/miniconda3/envs/multidms-dev/lib/python3.11/site-packages/Bio/PDB/StructureBuilder.py:89: PDBConstructionWarning: WARNING: Chain C is discontinuous at line 26328.
  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>which<span class="w"> </span>mkdssp
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mkdssp not found
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">structure</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dssp</span> <span class="o">=</span> <span class="n">DSSP</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s1">/pdb7tl9.pdb&#39;</span><span class="p">,</span> <span class="n">dssp</span><span class="o">=</span><span class="s1">&#39;mkdssp&#39;</span><span class="p">,</span> <span class="n">acc_array</span><span class="o">=</span><span class="s1">&#39;Wilke&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/site-packages/Bio/PDB/DSSP.py:385,</span> in <span class="ni">DSSP.__init__</span><span class="nt">(self, model, in_file, dssp, acc_array, file_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">385</span>     <span class="n">version_string</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span>         <span class="p">[</span><span class="n">dssp</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">],</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">387</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span>     <span class="n">dssp_version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*([\d.]+)&quot;</span><span class="p">,</span> <span class="n">version_string</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/subprocess.py:466,</span> in <span class="ni">check_output</span><span class="nt">(timeout, *popenargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">464</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span>
<span class="ne">--&gt; </span><span class="mi">466</span> <span class="k">return</span> <span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">popenargs</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">467</span>            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/subprocess.py:548,</span> in <span class="ni">run</span><span class="nt">(input, capture_output, timeout, check, *popenargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">546</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;stderr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PIPE</span>
<span class="ne">--&gt; </span><span class="mi">548</span> <span class="k">with</span> <span class="n">Popen</span><span class="p">(</span><span class="o">*</span><span class="n">popenargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">process</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">549</span>     <span class="k">try</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/subprocess.py:1026,</span> in <span class="ni">Popen.__init__</span><span class="nt">(self, args, bufsize, executable, stdin, stdout, stderr, preexec_fn, close_fds, shell, cwd, env, universal_newlines, startupinfo, creationflags, restore_signals, start_new_session, pass_fds, user, group, extra_groups, encoding, errors, text, umask, pipesize, process_group)</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span>             <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span>                     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_execute_child</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">executable</span><span class="p">,</span> <span class="n">preexec_fn</span><span class="p">,</span> <span class="n">close_fds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1027</span>                         <span class="n">pass_fds</span><span class="p">,</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1028</span>                         <span class="n">startupinfo</span><span class="p">,</span> <span class="n">creationflags</span><span class="p">,</span> <span class="n">shell</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1029</span>                         <span class="n">p2cread</span><span class="p">,</span> <span class="n">p2cwrite</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1030</span>                         <span class="n">c2pread</span><span class="p">,</span> <span class="n">c2pwrite</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1031</span>                         <span class="n">errread</span><span class="p">,</span> <span class="n">errwrite</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1032</span>                         <span class="n">restore_signals</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1033</span>                         <span class="n">gid</span><span class="p">,</span> <span class="n">gids</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">umask</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1034</span>                         <span class="n">start_new_session</span><span class="p">,</span> <span class="n">process_group</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1035</span> <span class="k">except</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1036</span>     <span class="c1"># Cleanup if the child failed starting.</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/subprocess.py:1950,</span> in <span class="ni">Popen._execute_child</span><span class="nt">(self, args, executable, preexec_fn, close_fds, pass_fds, cwd, env, startupinfo, creationflags, shell, p2cread, p2cwrite, c2pread, c2pwrite, errread, errwrite, restore_signals, gid, gids, uid, umask, start_new_session, process_group)</span>
<span class="g g-Whitespace">   </span><span class="mi">1949</span>         <span class="n">err_msg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">strerror</span><span class="p">(</span><span class="n">errno_num</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1950</span>     <span class="k">raise</span> <span class="n">child_exception_type</span><span class="p">(</span><span class="n">errno_num</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">,</span> <span class="n">err_filename</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1951</span> <span class="k">raise</span> <span class="n">child_exception_type</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;mkdssp&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">model</span> <span class="o">=</span> <span class="n">structure</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">dssp</span> <span class="o">=</span> <span class="n">DSSP</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s1">/pdb7tl9.pdb&#39;</span><span class="p">,</span> <span class="n">dssp</span><span class="o">=</span><span class="s1">&#39;mkdssp&#39;</span><span class="p">,</span> <span class="n">acc_array</span><span class="o">=</span><span class="s1">&#39;Wilke&#39;</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/site-packages/Bio/PDB/DSSP.py:399,</span> in <span class="ni">DSSP.__init__</span><span class="nt">(self, model, in_file, dssp, acc_array, file_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span>     <span class="k">raise</span>
<span class="ne">--&gt; </span><span class="mi">399</span> <span class="n">version_string</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>     <span class="p">[</span><span class="n">dssp</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">],</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span> <span class="n">dssp_version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*([\d.]+)&quot;</span><span class="p">,</span> <span class="n">version_string</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span> <span class="n">dssp_dict</span><span class="p">,</span> <span class="n">dssp_keys</span> <span class="o">=</span> <span class="n">dssp_dict_from_pdb_file</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="n">in_file</span><span class="p">,</span> <span class="n">dssp</span><span class="p">,</span> <span class="n">dssp_version</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span> <span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/subprocess.py:466,</span> in <span class="ni">check_output</span><span class="nt">(timeout, *popenargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">463</span>         <span class="n">empty</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">464</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span>
<span class="ne">--&gt; </span><span class="mi">466</span> <span class="k">return</span> <span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">popenargs</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">467</span>            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/subprocess.py:548,</span> in <span class="ni">run</span><span class="nt">(input, capture_output, timeout, check, *popenargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">545</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;stdout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PIPE</span>
<span class="g g-Whitespace">    </span><span class="mi">546</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;stderr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PIPE</span>
<span class="ne">--&gt; </span><span class="mi">548</span> <span class="k">with</span> <span class="n">Popen</span><span class="p">(</span><span class="o">*</span><span class="n">popenargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">process</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">549</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">550</span>         <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/subprocess.py:1026,</span> in <span class="ni">Popen.__init__</span><span class="nt">(self, args, bufsize, executable, stdin, stdout, stderr, preexec_fn, close_fds, shell, cwd, env, universal_newlines, startupinfo, creationflags, restore_signals, start_new_session, pass_fds, user, group, extra_groups, encoding, errors, text, umask, pipesize, process_group)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span>             <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span>                     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_execute_child</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">executable</span><span class="p">,</span> <span class="n">preexec_fn</span><span class="p">,</span> <span class="n">close_fds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1027</span>                         <span class="n">pass_fds</span><span class="p">,</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1028</span>                         <span class="n">startupinfo</span><span class="p">,</span> <span class="n">creationflags</span><span class="p">,</span> <span class="n">shell</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1029</span>                         <span class="n">p2cread</span><span class="p">,</span> <span class="n">p2cwrite</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1030</span>                         <span class="n">c2pread</span><span class="p">,</span> <span class="n">c2pwrite</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1031</span>                         <span class="n">errread</span><span class="p">,</span> <span class="n">errwrite</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1032</span>                         <span class="n">restore_signals</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1033</span>                         <span class="n">gid</span><span class="p">,</span> <span class="n">gids</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">umask</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1034</span>                         <span class="n">start_new_session</span><span class="p">,</span> <span class="n">process_group</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1035</span> <span class="k">except</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1036</span>     <span class="c1"># Cleanup if the child failed starting.</span>
<span class="g g-Whitespace">   </span><span class="mi">1037</span>     <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">)):</span>

<span class="nn">File ~/miniconda3/envs/multidms-dev/lib/python3.11/subprocess.py:1950,</span> in <span class="ni">Popen._execute_child</span><span class="nt">(self, args, executable, preexec_fn, close_fds, pass_fds, cwd, env, startupinfo, creationflags, shell, p2cread, p2cwrite, c2pread, c2pwrite, errread, errwrite, restore_signals, gid, gids, uid, umask, start_new_session, process_group)</span>
<span class="g g-Whitespace">   </span><span class="mi">1948</span>     <span class="k">if</span> <span class="n">errno_num</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1949</span>         <span class="n">err_msg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">strerror</span><span class="p">(</span><span class="n">errno_num</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1950</span>     <span class="k">raise</span> <span class="n">child_exception_type</span><span class="p">(</span><span class="n">errno_num</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">,</span> <span class="n">err_filename</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1951</span> <span class="k">raise</span> <span class="n">child_exception_type</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;dssp&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dssp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># relative solvent accessibility </span>
<span class="n">rsa_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">key</span> <span class="p">:</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">,</span> <span class="s1">&#39;rsa&#39;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">residues</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">get_residues</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get_id</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
    <span class="n">full_id</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">get_full_id</span><span class="p">()</span>
    <span class="n">res_n</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">full_id</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">chain</span> <span class="o">=</span> <span class="n">full_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">res_id</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>
    <span class="n">res_dssp</span> <span class="o">=</span> <span class="n">dssp</span><span class="p">[(</span><span class="n">chain</span><span class="p">,</span> <span class="n">res_id</span><span class="p">)]</span>
    <span class="n">rsa</span> <span class="o">=</span> <span class="n">res_dssp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">res_n</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
        <span class="k">continue</span>
    <span class="n">rsa_dict</span><span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">res_n</span><span class="p">))</span>
    <span class="n">rsa_dict</span><span class="p">[</span><span class="s1">&#39;rsa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rsa</span><span class="p">))</span>

<span class="n">rsa_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rsa_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rsa_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>res_n</th>
      <th>rsa</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>27</td>
      <td>0.589147</td>
    </tr>
    <tr>
      <th>1</th>
      <td>28</td>
      <td>0.615970</td>
    </tr>
    <tr>
      <th>2</th>
      <td>29</td>
      <td>0.063953</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>0.292308</td>
    </tr>
    <tr>
      <th>4</th>
      <td>31</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3069</th>
      <td>1143</td>
      <td>0.327044</td>
    </tr>
    <tr>
      <th>3070</th>
      <td>1144</td>
      <td>0.354260</td>
    </tr>
    <tr>
      <th>3071</th>
      <td>1145</td>
      <td>0.308458</td>
    </tr>
    <tr>
      <th>3072</th>
      <td>1146</td>
      <td>0.652850</td>
    </tr>
    <tr>
      <th>3073</th>
      <td>1147</td>
      <td>0.954839</td>
    </tr>
  </tbody>
</table>
<p>3074 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">omicron_name_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Omicron_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">mut_df_replicates</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;Omicron&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">}</span>
<span class="n">mut_df_replicates</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">omicron_name_map</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mut_df_replicates</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wts</th>
      <th>sites</th>
      <th>muts</th>
      <th>0_beta</th>
      <th>1_beta</th>
      <th>avg_beta</th>
      <th>0_S_Delta</th>
      <th>1_S_Delta</th>
      <th>avg_S_Delta</th>
      <th>0_S_BA2</th>
      <th>1_S_BA2</th>
      <th>avg_S_BA2</th>
    </tr>
    <tr>
      <th>mutation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A1015D</th>
      <td>A</td>
      <td>1015.0</td>
      <td>D</td>
      <td>-1.240629</td>
      <td>-2.365959</td>
      <td>-1.803294</td>
      <td>0.030702</td>
      <td>0.000000</td>
      <td>0.015351</td>
      <td>-0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>A1015S</th>
      <td>A</td>
      <td>1015.0</td>
      <td>S</td>
      <td>-0.194236</td>
      <td>-0.136035</td>
      <td>-0.165136</td>
      <td>-0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>-0.000037</td>
      <td>-0.000018</td>
    </tr>
    <tr>
      <th>A1015T</th>
      <td>A</td>
      <td>1015.0</td>
      <td>T</td>
      <td>-1.828467</td>
      <td>-1.701370</td>
      <td>-1.764919</td>
      <td>0.000000</td>
      <td>1.490752</td>
      <td>0.745376</td>
      <td>-0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>A1015V</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-4.209478</td>
      <td>-4.209478</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>A1016D</th>
      <td>A</td>
      <td>1016.0</td>
      <td>D</td>
      <td>-0.807699</td>
      <td>NaN</td>
      <td>-0.807699</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Y917F</th>
      <td>Y</td>
      <td>917.0</td>
      <td>F</td>
      <td>-0.292854</td>
      <td>-0.220422</td>
      <td>-0.256638</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Y917H</th>
      <td>Y</td>
      <td>917.0</td>
      <td>H</td>
      <td>-3.455611</td>
      <td>-2.315981</td>
      <td>-2.885796</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Y917N</th>
      <td>Y</td>
      <td>917.0</td>
      <td>N</td>
      <td>-2.435212</td>
      <td>NaN</td>
      <td>-2.435212</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Y91C</th>
      <td>Y</td>
      <td>91.0</td>
      <td>C</td>
      <td>-2.280230</td>
      <td>-2.743021</td>
      <td>-2.511626</td>
      <td>-0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Y91H</th>
      <td>Y</td>
      <td>91.0</td>
      <td>H</td>
      <td>-4.802296</td>
      <td>-3.860295</td>
      <td>-4.331295</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>6926 rows × 12 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">same_fx</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">cols_to_collapse</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mut_df_replicates</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;avg_&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
<span class="n">cols_to_collapse</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;sites&#39;</span><span class="p">])</span> <span class="c1">#, &#39;BA1_wt&#39;, &#39;BA2_wt&#39;, &#39;Delta_wt&#39;, &#39;is_BA2_wt&#39;, &#39;is_Delta_wt&#39;])</span>
<span class="n">shifts_by_site</span> <span class="o">=</span> <span class="n">mut_df_replicates</span><span class="p">[</span><span class="n">cols_to_collapse</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;sites&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="n">max_abs_S_BA2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;avg_S_BA2&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
    <span class="n">max_abs_S_Delta</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;avg_S_Delta&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
    
    <span class="n">mean_abs_S_BA2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;avg_S_BA2&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
    <span class="n">mean_abs_S_Delta</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;avg_S_Delta&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
    
    <span class="n">mean_S_BA2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;avg_S_BA2&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">),</span>
    <span class="n">mean_S_Delta</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;avg_S_Delta&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">),</span>
    
    <span class="n">sum_S_BA2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;avg_S_BA2&#39;</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">),</span>
    <span class="n">sum_S_Delta</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;avg_S_Delta&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">),</span>

<span class="c1">#     BA2_wt=(&#39;BA2_wt&#39;, same_fx),</span>
<span class="c1">#     Delta_wt=(&#39;Delta_wt&#39;, same_fx),</span>
<span class="c1">#     is_BA2_wt=(&#39;is_BA2_wt&#39;, same_fx),</span>
<span class="c1">#     is_Delta_wt=(&#39;is_Delta_wt&#39;, same_fx)</span>
<span class="p">)</span>
<span class="c1"># assert -1 not in shifts_by_site.Delta_wt</span>
<span class="c1"># # assert -1 not in shifts_by_site.BA1_wt</span>
<span class="c1"># assert -1 not in shifts_by_site.BA2_wt</span>
<span class="n">shifts_by_site</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>max_abs_S_BA2</th>
      <th>max_abs_S_Delta</th>
      <th>mean_abs_S_BA2</th>
      <th>mean_abs_S_Delta</th>
      <th>mean_S_BA2</th>
      <th>mean_S_Delta</th>
      <th>sum_S_BA2</th>
      <th>sum_S_Delta</th>
    </tr>
    <tr>
      <th>sites</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.0</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.101169</td>
      <td>0.000057</td>
      <td>0.025292</td>
      <td>0.000014</td>
      <td>-0.025292</td>
      <td>-0.000014</td>
      <td>-0.101169</td>
      <td>-0.000057</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>0.110149</td>
      <td>0.081638</td>
      <td>0.036175</td>
      <td>0.013606</td>
      <td>0.032394</td>
      <td>0.013606</td>
      <td>0.194364</td>
      <td>0.081638</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>0.061520</td>
      <td>0.117634</td>
      <td>0.023644</td>
      <td>0.042836</td>
      <td>-0.023644</td>
      <td>-0.035587</td>
      <td>-0.070931</td>
      <td>-0.106760</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>0.674212</td>
      <td>0.278434</td>
      <td>0.078759</td>
      <td>0.077590</td>
      <td>0.040040</td>
      <td>-0.075968</td>
      <td>0.720711</td>
      <td>-1.367432</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1248.0</th>
      <td>0.043042</td>
      <td>0.170719</td>
      <td>0.016369</td>
      <td>0.091856</td>
      <td>-0.002021</td>
      <td>0.047531</td>
      <td>-0.012128</td>
      <td>0.285185</td>
    </tr>
    <tr>
      <th>1249.0</th>
      <td>0.034893</td>
      <td>0.057105</td>
      <td>0.012851</td>
      <td>0.019018</td>
      <td>0.006072</td>
      <td>-0.014249</td>
      <td>0.036431</td>
      <td>-0.085495</td>
    </tr>
    <tr>
      <th>1250.0</th>
      <td>0.059849</td>
      <td>0.123525</td>
      <td>0.024961</td>
      <td>0.029137</td>
      <td>-0.007862</td>
      <td>0.029137</td>
      <td>-0.055031</td>
      <td>0.203961</td>
    </tr>
    <tr>
      <th>1251.0</th>
      <td>0.042119</td>
      <td>0.243781</td>
      <td>0.005265</td>
      <td>0.087776</td>
      <td>0.005265</td>
      <td>-0.087776</td>
      <td>0.042119</td>
      <td>-0.702206</td>
    </tr>
    <tr>
      <th>1252.0</th>
      <td>0.099596</td>
      <td>0.293961</td>
      <td>0.027368</td>
      <td>0.064510</td>
      <td>-0.019460</td>
      <td>-0.049478</td>
      <td>-0.389190</td>
      <td>-0.989550</td>
    </tr>
  </tbody>
</table>
<p>1235 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add non-identical flags to shifts_by_site</span>
<span class="n">rep0_model</span> <span class="o">=</span> <span class="n">chosen_replicate_models</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;replicate == 0&quot;</span><span class="p">)[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rep1_model</span> <span class="o">=</span> <span class="n">chosen_replicate_models</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;replicate == 1&quot;</span><span class="p">)[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">homolog</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Delta&quot;</span><span class="p">,</span><span class="s2">&quot;Omicron_BA2&quot;</span><span class="p">]:</span>
    <span class="n">nis_df</span> <span class="o">=</span> <span class="n">rep0_model</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">non_identical_sites</span><span class="p">[</span><span class="n">homolog</span><span class="p">]</span>
    
    <span class="c1"># assert our replicate model&#39;s inferred the same n.i.s&#39;s</span>
    <span class="k">assert</span> <span class="n">nis_df</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span>
        <span class="n">rep1_model</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">non_identical_sites</span><span class="p">[</span><span class="n">homolog</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">nis</span> <span class="o">=</span> <span class="n">nis_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
    <span class="n">hn</span> <span class="o">=</span> <span class="n">homolog</span> <span class="k">if</span> <span class="n">homolog</span> <span class="o">==</span> <span class="s2">&quot;Delta&quot;</span> <span class="k">else</span> <span class="s2">&quot;BA2&quot;</span>
    <span class="n">shifts_by_site</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;is_</span><span class="si">{</span><span class="n">hn</span><span class="si">}</span><span class="s2">_nis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">nis</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts_by_site</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="n">shifts_by_site</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>max_abs_S_BA2</th>
      <th>max_abs_S_Delta</th>
      <th>mean_abs_S_BA2</th>
      <th>mean_abs_S_Delta</th>
      <th>mean_S_BA2</th>
      <th>mean_S_Delta</th>
      <th>sum_S_BA2</th>
      <th>sum_S_Delta</th>
      <th>is_Delta_nis</th>
      <th>is_BA2_nis</th>
    </tr>
    <tr>
      <th>sites</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.0</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.101169</td>
      <td>0.000057</td>
      <td>0.025292</td>
      <td>0.000014</td>
      <td>-0.025292</td>
      <td>-0.000014</td>
      <td>-0.101169</td>
      <td>-0.000057</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>0.110149</td>
      <td>0.081638</td>
      <td>0.036175</td>
      <td>0.013606</td>
      <td>0.032394</td>
      <td>0.013606</td>
      <td>0.194364</td>
      <td>0.081638</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>0.061520</td>
      <td>0.117634</td>
      <td>0.023644</td>
      <td>0.042836</td>
      <td>-0.023644</td>
      <td>-0.035587</td>
      <td>-0.070931</td>
      <td>-0.106760</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>0.674212</td>
      <td>0.278434</td>
      <td>0.078759</td>
      <td>0.077590</td>
      <td>0.040040</td>
      <td>-0.075968</td>
      <td>0.720711</td>
      <td>-1.367432</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1248.0</th>
      <td>0.043042</td>
      <td>0.170719</td>
      <td>0.016369</td>
      <td>0.091856</td>
      <td>-0.002021</td>
      <td>0.047531</td>
      <td>-0.012128</td>
      <td>0.285185</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1249.0</th>
      <td>0.034893</td>
      <td>0.057105</td>
      <td>0.012851</td>
      <td>0.019018</td>
      <td>0.006072</td>
      <td>-0.014249</td>
      <td>0.036431</td>
      <td>-0.085495</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1250.0</th>
      <td>0.059849</td>
      <td>0.123525</td>
      <td>0.024961</td>
      <td>0.029137</td>
      <td>-0.007862</td>
      <td>0.029137</td>
      <td>-0.055031</td>
      <td>0.203961</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1251.0</th>
      <td>0.042119</td>
      <td>0.243781</td>
      <td>0.005265</td>
      <td>0.087776</td>
      <td>0.005265</td>
      <td>-0.087776</td>
      <td>0.042119</td>
      <td>-0.702206</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1252.0</th>
      <td>0.099596</td>
      <td>0.293961</td>
      <td>0.027368</td>
      <td>0.064510</td>
      <td>-0.019460</td>
      <td>-0.049478</td>
      <td>-0.389190</td>
      <td>-0.989550</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>1235 rows × 10 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shifts_by_site</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_set</span><span class="si">}</span><span class="s2">/shifts_by_site.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shifts_by_site</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_set</span><span class="si">}</span><span class="s2">/shifts_by_site.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">shifts_by_site</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sites</th>
      <th>max_abs_S_BA2</th>
      <th>max_abs_S_Delta</th>
      <th>mean_abs_S_BA2</th>
      <th>mean_abs_S_Delta</th>
      <th>mean_S_BA2</th>
      <th>mean_S_Delta</th>
      <th>sum_S_BA2</th>
      <th>sum_S_Delta</th>
      <th>is_Delta_nis</th>
      <th>is_BA2_nis</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>0.101169</td>
      <td>0.000057</td>
      <td>0.025292</td>
      <td>0.000014</td>
      <td>-0.025292</td>
      <td>-0.000014</td>
      <td>-0.101169</td>
      <td>-0.000057</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.110149</td>
      <td>0.081638</td>
      <td>0.036175</td>
      <td>0.013606</td>
      <td>0.032394</td>
      <td>0.013606</td>
      <td>0.194364</td>
      <td>0.081638</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>0.061520</td>
      <td>0.117634</td>
      <td>0.023644</td>
      <td>0.042836</td>
      <td>-0.023644</td>
      <td>-0.035587</td>
      <td>-0.070931</td>
      <td>-0.106760</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>0.674212</td>
      <td>0.278434</td>
      <td>0.078759</td>
      <td>0.077590</td>
      <td>0.040040</td>
      <td>-0.075968</td>
      <td>0.720711</td>
      <td>-1.367432</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1230</th>
      <td>1248.0</td>
      <td>0.043042</td>
      <td>0.170719</td>
      <td>0.016369</td>
      <td>0.091856</td>
      <td>-0.002021</td>
      <td>0.047531</td>
      <td>-0.012128</td>
      <td>0.285185</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1231</th>
      <td>1249.0</td>
      <td>0.034893</td>
      <td>0.057105</td>
      <td>0.012851</td>
      <td>0.019018</td>
      <td>0.006072</td>
      <td>-0.014249</td>
      <td>0.036431</td>
      <td>-0.085495</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1232</th>
      <td>1250.0</td>
      <td>0.059849</td>
      <td>0.123525</td>
      <td>0.024961</td>
      <td>0.029137</td>
      <td>-0.007862</td>
      <td>0.029137</td>
      <td>-0.055031</td>
      <td>0.203961</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1233</th>
      <td>1251.0</td>
      <td>0.042119</td>
      <td>0.243781</td>
      <td>0.005265</td>
      <td>0.087776</td>
      <td>0.005265</td>
      <td>-0.087776</td>
      <td>0.042119</td>
      <td>-0.702206</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1234</th>
      <td>1252.0</td>
      <td>0.099596</td>
      <td>0.293961</td>
      <td>0.027368</td>
      <td>0.064510</td>
      <td>-0.019460</td>
      <td>-0.049478</td>
      <td>-0.389190</td>
      <td>-0.989550</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>1235 rows × 11 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each site, take the mean RSA across all chains</span>
<span class="n">rsa_df</span> <span class="o">=</span> <span class="n">rsa_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;res_n&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">rsa_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rsa_df</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">rsa_df</span><span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">]))</span>

<span class="c1"># Merge into dataframe with sitewise shift summary stats</span>
<span class="k">if</span> <span class="s1">&#39;rsa&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shifts_by_site</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">shifts_by_site</span> <span class="o">=</span> <span class="n">shifts_by_site</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">rsa_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;sites&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;res_n&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">rsa_df</span><span class="p">[</span><span class="s1">&#39;rsa&#39;</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/08e73155184b4471a62a3bbd8ced5301fd788ed03f4a23283048509217839ff5.png" src="_images/08e73155184b4471a62a3bbd8ced5301fd788ed03f4a23283048509217839ff5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rsa&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;max_abs_S_Delta&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">shifts_by_site</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;rsa&#39;, ylabel=&#39;max_abs_S_Delta&#39;&gt;
</pre></div>
</div>
<img alt="_images/554f832ebaf7295c8bd01c36c58ecaf368fce5f1d78201b58c6010ca15fc4e9d.png" src="_images/554f832ebaf7295c8bd01c36c58ecaf368fce5f1d78201b58c6010ca15fc4e9d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># shifts_by_site</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># metric_prefix = &#39;max_abs_S&#39;</span>

<span class="c1"># def group_site(metric):</span>
<span class="c1">#     if metric &lt; 0.1:</span>
<span class="c1">#         return &#39;0.0-0.1&#39;</span>
<span class="c1">#     elif metric &lt; 0.2:</span>
<span class="c1">#         return &#39;0.1-0.2&#39;</span>
<span class="c1">#     elif metric &lt; 0.3:</span>
<span class="c1">#         return &#39;0.2-0.3&#39;</span>
<span class="c1">#     elif metric &lt; 0.4:</span>
<span class="c1">#         return &#39;0.3-0.4&#39;</span>
<span class="c1">#     else:</span>
<span class="c1">#         return &#39;&gt;0.4&#39;</span>

<span class="c1"># (fig, axs) = plt.subplots(</span>
<span class="c1">#     ncols=2, sharex=True, sharey=True,</span>
<span class="c1">#     figsize=[8,4]</span>
<span class="c1"># )</span>
<span class="c1"># for (i, homolog) in enumerate([&#39;BA2&#39;, &#39;Delta&#39;]):</span>
<span class="c1"># #     metric = f&#39;{metric_prefix}_{homolog}_cons&#39;</span>
<span class="c1">#     metric = f&#39;{metric_prefix}_{homolog}&#39;</span>
<span class="c1">#     print(metric)</span>
<span class="c1">#     shifts_by_site[&#39;group&#39;] = shifts_by_site[&#39;rsa&#39;].apply(lambda x: group_site(x))</span>
<span class="c1">#     group_order = [&#39;0.0-0.1&#39;, &#39;0.1-0.2&#39;, &#39;0.2-0.3&#39;, &#39;0.3-0.4&#39;, &#39;&gt;0.4&#39;]</span>
<span class="c1">#     sns.boxplot(</span>
<span class="c1">#         x=metric, y=&#39;group&#39;, data=shifts_by_site,</span>
<span class="c1">#         order=group_order,</span>
<span class="c1">#         ax=axs[i], #showfliers=False,</span>
<span class="c1">#         color=&#39;0.5&#39;</span>
<span class="c1">#     )</span>
<span class="c1">#     axs[i].set(</span>
<span class="c1">#         title=homolog.replace(&#39;Omicron_&#39;, &#39;&#39;),</span>
<span class="c1">#         xlabel=&#39;&#39;</span>
<span class="c1">#     )</span>
<span class="c1">#     axs[i].grid()</span>
    
<span class="c1"># xlabel = &#39;max. abs. shift at site&#39;</span>
<span class="c1"># fig.text(0.565, -0.02, xlabel, ha=&#39;center&#39;)</span>
<span class="c1"># axs[0].set(ylabel=&#39;RSA of residue&#39;)</span>
<span class="c1"># axs[1].set(ylabel=&#39;&#39;)</span>
<span class="c1"># plt.tight_layout()</span>
<span class="c1"># sns.despine()</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a list of residues, ignorning heteroatoms</span>
<span class="n">residues</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">get_residues</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get_id</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">]</span>
<span class="n">res_ns</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">res_ids</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
    <span class="n">full_id</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">get_full_id</span><span class="p">()</span>
    <span class="n">chain</span> <span class="o">=</span> <span class="n">full_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">res_n</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">full_id</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">res_n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_ns</span><span class="p">)</span> <span class="ow">and</span> <span class="n">chain</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
        <span class="n">res_ns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_n</span><span class="p">)</span>
    <span class="n">res_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">chain</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">res_n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute a distance matrix between all pairs of C-alpha carbons</span>
<span class="n">dist_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">key</span> <span class="p">:</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">,</span> <span class="s1">&#39;res_id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">res_ids</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">res_i</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
    <span class="n">full_id_i</span> <span class="o">=</span> <span class="n">res_i</span><span class="o">.</span><span class="n">get_full_id</span><span class="p">()</span>
    <span class="n">chain_i</span> <span class="o">=</span> <span class="n">full_id_i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">res_n_i</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">full_id_i</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">dist_dict</span><span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_n_i</span><span class="p">)</span>
    <span class="n">dist_dict</span><span class="p">[</span><span class="s1">&#39;res_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">chain_i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">res_n_i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">res_j</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
        <span class="n">full_id_j</span> <span class="o">=</span> <span class="n">res_j</span><span class="o">.</span><span class="n">get_full_id</span><span class="p">()</span>
        <span class="n">chain_j</span> <span class="o">=</span> <span class="n">full_id_j</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">res_n_j</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">full_id_j</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">xyz_i</span> <span class="o">=</span> <span class="n">res_i</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_coord</span><span class="p">()</span>
        <span class="n">xyz_j</span> <span class="o">=</span> <span class="n">res_j</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_coord</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xyz_j</span><span class="o">-</span><span class="n">xyz_i</span><span class="p">)</span>
        <span class="n">dist_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">chain_j</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">res_n_j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">dist_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dist_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>res_n</th>
      <th>res_id</th>
      <th>A_27</th>
      <th>A_28</th>
      <th>A_29</th>
      <th>A_30</th>
      <th>A_31</th>
      <th>A_32</th>
      <th>A_33</th>
      <th>A_34</th>
      <th>...</th>
      <th>C_1138</th>
      <th>C_1139</th>
      <th>C_1140</th>
      <th>C_1141</th>
      <th>C_1142</th>
      <th>C_1143</th>
      <th>C_1144</th>
      <th>C_1145</th>
      <th>C_1146</th>
      <th>C_1147</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>27</td>
      <td>A_27</td>
      <td>0.000000</td>
      <td>3.811378</td>
      <td>7.066604</td>
      <td>10.724298</td>
      <td>12.775757</td>
      <td>15.995064</td>
      <td>19.204714</td>
      <td>18.059219</td>
      <td>...</td>
      <td>111.486176</td>
      <td>112.094078</td>
      <td>114.077385</td>
      <td>115.041245</td>
      <td>117.297478</td>
      <td>120.138023</td>
      <td>120.388802</td>
      <td>120.366440</td>
      <td>123.270622</td>
      <td>125.427475</td>
    </tr>
    <tr>
      <th>1</th>
      <td>28</td>
      <td>A_28</td>
      <td>3.811378</td>
      <td>0.000000</td>
      <td>3.792945</td>
      <td>7.113520</td>
      <td>9.232011</td>
      <td>12.394494</td>
      <td>15.648566</td>
      <td>14.825809</td>
      <td>...</td>
      <td>107.984886</td>
      <td>108.616722</td>
      <td>110.575645</td>
      <td>111.586060</td>
      <td>113.856323</td>
      <td>116.660995</td>
      <td>116.926308</td>
      <td>116.953598</td>
      <td>119.845879</td>
      <td>121.985664</td>
    </tr>
    <tr>
      <th>2</th>
      <td>29</td>
      <td>A_29</td>
      <td>7.066604</td>
      <td>3.792945</td>
      <td>0.000000</td>
      <td>3.791088</td>
      <td>6.453536</td>
      <td>9.112085</td>
      <td>12.574587</td>
      <td>12.103994</td>
      <td>...</td>
      <td>104.965385</td>
      <td>105.670792</td>
      <td>107.688446</td>
      <td>108.741814</td>
      <td>110.950180</td>
      <td>113.757462</td>
      <td>114.103615</td>
      <td>114.116539</td>
      <td>116.956192</td>
      <td>119.151108</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>A_30</td>
      <td>10.724298</td>
      <td>7.113520</td>
      <td>3.791088</td>
      <td>0.000000</td>
      <td>3.806618</td>
      <td>5.562723</td>
      <td>9.210176</td>
      <td>9.552019</td>
      <td>...</td>
      <td>101.445549</td>
      <td>102.181206</td>
      <td>104.179802</td>
      <td>105.282890</td>
      <td>107.498726</td>
      <td>110.270241</td>
      <td>110.638107</td>
      <td>110.698540</td>
      <td>113.520889</td>
      <td>115.703545</td>
    </tr>
    <tr>
      <th>4</th>
      <td>31</td>
      <td>A_31</td>
      <td>12.775757</td>
      <td>9.232011</td>
      <td>6.453536</td>
      <td>3.806618</td>
      <td>0.000000</td>
      <td>3.854705</td>
      <td>6.462251</td>
      <td>6.005359</td>
      <td>...</td>
      <td>101.215691</td>
      <td>102.048409</td>
      <td>104.004578</td>
      <td>105.236839</td>
      <td>107.461861</td>
      <td>110.143196</td>
      <td>110.571861</td>
      <td>110.745842</td>
      <td>113.519531</td>
      <td>115.676926</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3078</th>
      <td>1143</td>
      <td>C_1143</td>
      <td>120.138023</td>
      <td>116.660995</td>
      <td>113.757462</td>
      <td>110.270241</td>
      <td>110.143196</td>
      <td>106.533920</td>
      <td>105.164299</td>
      <td>108.633011</td>
      <td>...</td>
      <td>10.400323</td>
      <td>8.300558</td>
      <td>6.408051</td>
      <td>5.870679</td>
      <td>3.876984</td>
      <td>0.000000</td>
      <td>3.810018</td>
      <td>5.291936</td>
      <td>5.008859</td>
      <td>6.659175</td>
    </tr>
    <tr>
      <th>3079</th>
      <td>1144</td>
      <td>C_1144</td>
      <td>120.388802</td>
      <td>116.926308</td>
      <td>114.103615</td>
      <td>110.638107</td>
      <td>110.571861</td>
      <td>107.008766</td>
      <td>105.709282</td>
      <td>109.216736</td>
      <td>...</td>
      <td>12.961762</td>
      <td>10.062057</td>
      <td>7.450271</td>
      <td>5.487663</td>
      <td>5.370954</td>
      <td>3.810018</td>
      <td>0.000000</td>
      <td>3.809529</td>
      <td>5.370581</td>
      <td>5.337458</td>
    </tr>
    <tr>
      <th>3080</th>
      <td>1145</td>
      <td>C_1145</td>
      <td>120.366440</td>
      <td>116.953598</td>
      <td>114.116539</td>
      <td>110.698540</td>
      <td>110.745842</td>
      <td>107.165985</td>
      <td>105.970909</td>
      <td>109.512878</td>
      <td>...</td>
      <td>13.562173</td>
      <td>10.486953</td>
      <td>9.130998</td>
      <td>6.117291</td>
      <td>4.709569</td>
      <td>5.291936</td>
      <td>3.809529</td>
      <td>0.000000</td>
      <td>3.817745</td>
      <td>5.496093</td>
    </tr>
    <tr>
      <th>3081</th>
      <td>1146</td>
      <td>C_1146</td>
      <td>123.270622</td>
      <td>119.845879</td>
      <td>116.956192</td>
      <td>113.520889</td>
      <td>113.519531</td>
      <td>109.908821</td>
      <td>108.655510</td>
      <td>112.167007</td>
      <td>...</td>
      <td>14.363069</td>
      <td>12.058798</td>
      <td>10.849333</td>
      <td>8.840470</td>
      <td>6.136176</td>
      <td>5.008859</td>
      <td>5.370581</td>
      <td>3.817745</td>
      <td>0.000000</td>
      <td>3.822588</td>
    </tr>
    <tr>
      <th>3082</th>
      <td>1147</td>
      <td>C_1147</td>
      <td>125.427475</td>
      <td>121.985664</td>
      <td>119.151108</td>
      <td>115.703545</td>
      <td>115.676926</td>
      <td>112.101311</td>
      <td>110.830452</td>
      <td>114.344521</td>
      <td>...</td>
      <td>16.967741</td>
      <td>14.508314</td>
      <td>12.396870</td>
      <td>10.447202</td>
      <td>8.850454</td>
      <td>6.659175</td>
      <td>5.337458</td>
      <td>5.496093</td>
      <td>3.822588</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>3083 rows × 3085 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, collapse rows by site (ignoring chain),</span>
<span class="c1"># taking the min value across common entries</span>
<span class="n">min_dist_df</span> <span class="o">=</span> <span class="n">dist_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;res_n&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">min_dist_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">del</span> <span class="n">min_dist_df</span><span class="p">[</span><span class="s1">&#39;res_id&#39;</span><span class="p">]</span>

<span class="c1"># Then, transpose the dataframe and do that same</span>
<span class="c1"># as above</span>
<span class="n">min_dist_df</span> <span class="o">=</span> <span class="n">min_dist_df</span><span class="o">.</span><span class="n">T</span>
<span class="n">min_dist_df</span><span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_dist_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">min_dist_df</span> <span class="o">=</span> <span class="n">min_dist_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;res_n&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">min_dist_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_dist_df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="c1">#min_dist_df.reset_index(inplace=True)</span>
<span class="n">min_dist_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1050 1050
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>100</th>
      <th>1000</th>
      <th>1001</th>
      <th>1002</th>
      <th>1003</th>
      <th>1004</th>
      <th>1005</th>
      <th>1006</th>
      <th>1007</th>
      <th>1008</th>
      <th>...</th>
      <th>990</th>
      <th>991</th>
      <th>992</th>
      <th>993</th>
      <th>994</th>
      <th>995</th>
      <th>996</th>
      <th>997</th>
      <th>998</th>
      <th>999</th>
    </tr>
    <tr>
      <th>res_n</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>100</th>
      <td>0.000000</td>
      <td>57.269909</td>
      <td>58.147030</td>
      <td>60.695450</td>
      <td>58.111557</td>
      <td>60.520302</td>
      <td>61.691601</td>
      <td>61.780830</td>
      <td>61.046352</td>
      <td>63.394779</td>
      <td>...</td>
      <td>51.363022</td>
      <td>54.775097</td>
      <td>55.140244</td>
      <td>54.476303</td>
      <td>54.531651</td>
      <td>57.047848</td>
      <td>55.383244</td>
      <td>55.728683</td>
      <td>57.875916</td>
      <td>57.077015</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>57.269909</td>
      <td>0.000000</td>
      <td>3.819779</td>
      <td>5.389774</td>
      <td>4.914857</td>
      <td>6.142662</td>
      <td>8.594710</td>
      <td>9.810758</td>
      <td>10.569769</td>
      <td>12.350356</td>
      <td>...</td>
      <td>15.127206</td>
      <td>14.059226</td>
      <td>12.457101</td>
      <td>10.361587</td>
      <td>9.917969</td>
      <td>8.585588</td>
      <td>6.091770</td>
      <td>5.201756</td>
      <td>5.581903</td>
      <td>3.804441</td>
    </tr>
    <tr>
      <th>1001</th>
      <td>58.147030</td>
      <td>3.819779</td>
      <td>0.000000</td>
      <td>3.816221</td>
      <td>5.389239</td>
      <td>5.022686</td>
      <td>6.118761</td>
      <td>8.605238</td>
      <td>9.833795</td>
      <td>10.475564</td>
      <td>...</td>
      <td>15.863819</td>
      <td>14.898405</td>
      <td>14.235265</td>
      <td>11.921385</td>
      <td>10.342891</td>
      <td>9.849586</td>
      <td>8.445177</td>
      <td>5.981167</td>
      <td>5.138320</td>
      <td>5.423058</td>
    </tr>
    <tr>
      <th>1002</th>
      <td>60.695450</td>
      <td>5.389774</td>
      <td>3.816221</td>
      <td>0.000000</td>
      <td>3.818494</td>
      <td>5.357216</td>
      <td>4.953300</td>
      <td>6.177926</td>
      <td>8.644234</td>
      <td>9.849512</td>
      <td>...</td>
      <td>17.989258</td>
      <td>16.279930</td>
      <td>15.468401</td>
      <td>14.054370</td>
      <td>12.099788</td>
      <td>10.551577</td>
      <td>9.880887</td>
      <td>8.490767</td>
      <td>6.081089</td>
      <td>5.108419</td>
    </tr>
    <tr>
      <th>1003</th>
      <td>58.111557</td>
      <td>4.914857</td>
      <td>5.389239</td>
      <td>3.818494</td>
      <td>0.000000</td>
      <td>3.809511</td>
      <td>5.443557</td>
      <td>5.052581</td>
      <td>6.264480</td>
      <td>8.711477</td>
      <td>...</td>
      <td>19.667000</td>
      <td>18.135782</td>
      <td>16.670715</td>
      <td>15.049732</td>
      <td>14.144258</td>
      <td>12.277769</td>
      <td>10.497149</td>
      <td>9.762023</td>
      <td>8.575770</td>
      <td>6.147751</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 1050 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">min_dist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">res_ns</span><span class="p">][</span><span class="n">res_ns</span><span class="p">],</span>
    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/69bcc8450184a7921327b89250d21d55ae890307ba899afc3de7dbfb944825d8.png" src="_images/69bcc8450184a7921327b89250d21d55ae890307ba899afc3de7dbfb944825d8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shifts_by_site</span><span class="p">[</span><span class="s2">&quot;res_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shifts_by_site</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shifts_by_site</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sites</th>
      <th>max_abs_S_BA2</th>
      <th>max_abs_S_Delta</th>
      <th>mean_abs_S_BA2</th>
      <th>mean_abs_S_Delta</th>
      <th>mean_S_BA2</th>
      <th>mean_S_Delta</th>
      <th>sum_S_BA2</th>
      <th>sum_S_Delta</th>
      <th>is_Delta_nis</th>
      <th>is_BA2_nis</th>
      <th>res_n</th>
      <th>rsa</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>False</td>
      <td>False</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>0.101169</td>
      <td>0.000057</td>
      <td>0.025292</td>
      <td>0.000014</td>
      <td>-0.025292</td>
      <td>-0.000014</td>
      <td>-0.101169</td>
      <td>-0.000057</td>
      <td>False</td>
      <td>False</td>
      <td>2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.110149</td>
      <td>0.081638</td>
      <td>0.036175</td>
      <td>0.013606</td>
      <td>0.032394</td>
      <td>0.013606</td>
      <td>0.194364</td>
      <td>0.081638</td>
      <td>False</td>
      <td>False</td>
      <td>3</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>0.061520</td>
      <td>0.117634</td>
      <td>0.023644</td>
      <td>0.042836</td>
      <td>-0.023644</td>
      <td>-0.035587</td>
      <td>-0.070931</td>
      <td>-0.106760</td>
      <td>False</td>
      <td>False</td>
      <td>4</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>0.674212</td>
      <td>0.278434</td>
      <td>0.078759</td>
      <td>0.077590</td>
      <td>0.040040</td>
      <td>-0.075968</td>
      <td>0.720711</td>
      <td>-1.367432</td>
      <td>False</td>
      <td>False</td>
      <td>5</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1230</th>
      <td>1248.0</td>
      <td>0.043042</td>
      <td>0.170719</td>
      <td>0.016369</td>
      <td>0.091856</td>
      <td>-0.002021</td>
      <td>0.047531</td>
      <td>-0.012128</td>
      <td>0.285185</td>
      <td>False</td>
      <td>False</td>
      <td>1248</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1231</th>
      <td>1249.0</td>
      <td>0.034893</td>
      <td>0.057105</td>
      <td>0.012851</td>
      <td>0.019018</td>
      <td>0.006072</td>
      <td>-0.014249</td>
      <td>0.036431</td>
      <td>-0.085495</td>
      <td>False</td>
      <td>False</td>
      <td>1249</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1232</th>
      <td>1250.0</td>
      <td>0.059849</td>
      <td>0.123525</td>
      <td>0.024961</td>
      <td>0.029137</td>
      <td>-0.007862</td>
      <td>0.029137</td>
      <td>-0.055031</td>
      <td>0.203961</td>
      <td>False</td>
      <td>False</td>
      <td>1250</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1233</th>
      <td>1251.0</td>
      <td>0.042119</td>
      <td>0.243781</td>
      <td>0.005265</td>
      <td>0.087776</td>
      <td>0.005265</td>
      <td>-0.087776</td>
      <td>0.042119</td>
      <td>-0.702206</td>
      <td>False</td>
      <td>False</td>
      <td>1251</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1234</th>
      <td>1252.0</td>
      <td>0.099596</td>
      <td>0.293961</td>
      <td>0.027368</td>
      <td>0.064510</td>
      <td>-0.019460</td>
      <td>-0.049478</td>
      <td>-0.389190</td>
      <td>-0.989550</td>
      <td>False</td>
      <td>False</td>
      <td>1252</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>1235 rows × 13 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge per-site data with distance matrix</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">shifts_by_site</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">min_dist_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;res_n&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shifts_by_site</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_dist_df</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1235 1050 1041
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data.query(&quot;&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metric_prefix</span> <span class="o">=</span><span class="s2">&quot;max_abs_S&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each site, compute the average metric among</span>
<span class="c1"># all neighbors</span>
<span class="n">nbr_dist_cutoff</span> <span class="o">=</span> <span class="mi">8</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using a neighbor distance cutoff of </span><span class="si">{</span><span class="n">nbr_dist_cutoff</span><span class="si">}</span><span class="s1"> Angstroms&#39;</span><span class="p">)</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">metric_prefix</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
<span class="n">nbr_score_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">key</span> <span class="p">:</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">,</span> <span class="s1">&#39;n_nbrs&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;nbr_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">]</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">res_n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">res_ns</span><span class="p">)):</span>
    <span class="n">nbr_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
        <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">res_n</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nbr_dist_cutoff</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">res_n</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">nbr_score_dict</span><span class="p">[</span><span class="s1">&#39;res_n&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_n</span><span class="p">)</span>
    <span class="n">nbr_score_dict</span><span class="p">[</span><span class="s1">&#39;n_nbrs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nbr_data</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
        <span class="n">nbr_score_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;nbr_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nbr_data</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">nbr_score_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">nbr_score_dict</span><span class="p">)</span>
<span class="n">nbr_score_df</span> <span class="o">=</span> <span class="n">nbr_score_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;res_n&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using a neighbor distance cutoff of 8 Angstroms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">homolog</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Delta&quot;</span><span class="p">,</span> <span class="s2">&quot;BA2&quot;</span><span class="p">]:</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nbr_score_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="c1">#     print(bins)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">nbr_score_df</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8c18906c473fad0babe52abc71bb8937d138ccbaee57d7e35a6c6b017181fa13.png" src="_images/8c18906c473fad0babe52abc71bb8937d138ccbaee57d7e35a6c6b017181fa13.png" />
<img alt="_images/648739affc65206aa139dbce07e6dbf96d6abf0678732473c7d1b80770ca1d10.png" src="_images/648739affc65206aa139dbce07e6dbf96d6abf0678732473c7d1b80770ca1d10.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nbr_score_df</span><span class="p">[</span><span class="s1">&#39;n_nbrs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;n_nbrs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">nbr_score_df</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/db001a8016a59e92e24c8d70d2695c20a4c229a7993c08ea9bd9e542d0c1f708.png" src="_images/db001a8016a59e92e24c8d70d2695c20a4c229a7993c08ea9bd9e542d0c1f708.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># nbr_score_df[&quot;is_Delta_nis&quot;] = ~nbr_score_df[&quot;is_Delta_wt&quot;]</span>
<span class="c1"># nbr_score_df[&quot;is_BA2_nis&quot;] = ~nbr_score_df[&quot;is_BA2_wt&quot;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def group_site_fine(metric):</span>
<span class="c1">#     if metric &lt; 0.1:</span>
<span class="c1">#         return &#39;0.0-0.1&#39;</span>
<span class="c1">#     elif metric &lt; 0.5:</span>
<span class="c1">#         return &#39;0.1-0.5&#39;</span>
<span class="c1">#     else:</span>
<span class="c1">#         return &#39;&gt;0.5&#39;</span>
    
<span class="c1"># fine_group_order = [&#39;0.0-0.1&#39;, &#39;0.1-0.5&#39;, &#39;&gt;0.5&#39;]</span>

<span class="k">for</span> <span class="n">homolog</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;BA2&#39;</span><span class="p">,</span> <span class="s1">&#39;Delta&#39;</span><span class="p">]:</span>

<span class="c1">#     nbr_score_df[f&quot;fine_group_{homolog}&quot;] = nbr_score_df[</span>
<span class="c1">#         f&quot;{metric_prefix}_{homolog}&quot;</span>
<span class="c1">#     ].apply(lambda x: group_site_fine(x))</span>
    
    
    <span class="c1"># get all nis for condition d</span>
    <span class="n">nis</span> <span class="o">=</span> <span class="n">nbr_score_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis == True&quot;</span><span class="p">)[</span><span class="s2">&quot;res_n&quot;</span><span class="p">]</span>
    <span class="n">nbr_score_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbr_score_df</span><span class="p">[</span><span class="n">nis</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># nbr_score_df[f&quot;fine_group_Delta&quot;].value_counts()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># nbr_score_df[f&quot;fine_group_BA2&quot;].value_counts()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbr_score_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;dist_nearest_BA2_nis&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s2">&quot;res_n&quot;</span><span class="p">,</span> <span class="s2">&quot;n_nbrs&quot;</span><span class="p">,</span><span class="s2">&quot;dist_nearest_BA2_nis&quot;</span> <span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>res_n</th>
      <th>n_nbrs</th>
      <th>dist_nearest_BA2_nis</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>785</th>
      <td>1147</td>
      <td>4</td>
      <td>96.352722</td>
    </tr>
    <tr>
      <th>597</th>
      <td>1146</td>
      <td>5</td>
      <td>95.568420</td>
    </tr>
    <tr>
      <th>106</th>
      <td>1145</td>
      <td>6</td>
      <td>93.648468</td>
    </tr>
    <tr>
      <th>727</th>
      <td>1144</td>
      <td>7</td>
      <td>91.465714</td>
    </tr>
    <tr>
      <th>88</th>
      <td>1143</td>
      <td>8</td>
      <td>91.405632</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbr_score_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OUTDIR</span><span class="si">}</span><span class="s2">/nbr_score_df.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from scipy.stats import permutation_test</span>
<span class="c1"># def statistic(x, y, axis):</span>
<span class="c1">#     return np.median(x, axis=axis) - np.median(y, axis=axis)</span>
<span class="c1"># sig = permutation_test(</span>
<span class="c1">#     [</span>
<span class="c1">#         nbr_score_df.query(&quot;fine_group_BA2 == &#39;0.0-0.5&#39;&quot;)[&quot;nbr_max_abs_S_BA2&quot;].values,</span>
<span class="c1">#         nbr_score_df.query(&quot;fine_group_BA2 == &#39;&gt;1.0&#39;&quot;)[&quot;nbr_max_abs_S_BA2&quot;].values</span>
<span class="c1">#     ],</span>
<span class="c1">#     statistic,</span>
<span class="c1">#     n_resamples=100000</span>
<span class="c1"># )</span>
<span class="c1"># sig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from statannotations.Annotator import Annotator</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbr_score_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>res_n</th>
      <th>n_nbrs</th>
      <th>nbr_max_abs_S_BA2</th>
      <th>nbr_max_abs_S_Delta</th>
      <th>sites</th>
      <th>max_abs_S_BA2</th>
      <th>max_abs_S_Delta</th>
      <th>mean_abs_S_BA2</th>
      <th>mean_abs_S_Delta</th>
      <th>mean_S_BA2</th>
      <th>...</th>
      <th>992</th>
      <th>993</th>
      <th>994</th>
      <th>995</th>
      <th>996</th>
      <th>997</th>
      <th>998</th>
      <th>999</th>
      <th>dist_nearest_BA2_nis</th>
      <th>dist_nearest_Delta_nis</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000</td>
      <td>11</td>
      <td>0.167239</td>
      <td>0.393864</td>
      <td>1000.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>...</td>
      <td>12.457101</td>
      <td>10.361587</td>
      <td>9.917969</td>
      <td>8.585588</td>
      <td>6.091770</td>
      <td>5.201756</td>
      <td>5.581903</td>
      <td>3.804441</td>
      <td>12.389872</td>
      <td>9.707668</td>
    </tr>
    <tr>
      <th>1</th>
      <td>492</td>
      <td>9</td>
      <td>0.138059</td>
      <td>0.541581</td>
      <td>492.0</td>
      <td>0.000000</td>
      <td>0.734777</td>
      <td>0.000000</td>
      <td>2.555983e-01</td>
      <td>0.000000</td>
      <td>...</td>
      <td>40.064369</td>
      <td>40.360153</td>
      <td>42.315041</td>
      <td>44.695766</td>
      <td>45.216492</td>
      <td>45.766441</td>
      <td>48.289612</td>
      <td>50.168259</td>
      <td>11.972104</td>
      <td>3.805705</td>
    </tr>
    <tr>
      <th>2</th>
      <td>228</td>
      <td>8</td>
      <td>0.130960</td>
      <td>0.189775</td>
      <td>228.0</td>
      <td>0.354076</td>
      <td>0.107416</td>
      <td>0.140035</td>
      <td>2.956404e-02</td>
      <td>-0.140035</td>
      <td>...</td>
      <td>32.242271</td>
      <td>33.289577</td>
      <td>34.716755</td>
      <td>34.912189</td>
      <td>33.079311</td>
      <td>36.393677</td>
      <td>38.337685</td>
      <td>36.021049</td>
      <td>23.397993</td>
      <td>23.397993</td>
    </tr>
    <tr>
      <th>3</th>
      <td>61</td>
      <td>9</td>
      <td>0.480901</td>
      <td>0.224950</td>
      <td>61.0</td>
      <td>0.155122</td>
      <td>0.171973</td>
      <td>0.062720</td>
      <td>7.328390e-02</td>
      <td>-0.062710</td>
      <td>...</td>
      <td>43.456558</td>
      <td>40.592903</td>
      <td>40.862759</td>
      <td>44.256191</td>
      <td>42.926723</td>
      <td>40.088356</td>
      <td>42.652607</td>
      <td>43.698330</td>
      <td>9.074236</td>
      <td>16.673040</td>
    </tr>
    <tr>
      <th>4</th>
      <td>721</td>
      <td>11</td>
      <td>0.192934</td>
      <td>0.767185</td>
      <td>721.0</td>
      <td>0.000000</td>
      <td>0.000003</td>
      <td>0.000000</td>
      <td>6.829245e-07</td>
      <td>0.000000</td>
      <td>...</td>
      <td>65.294762</td>
      <td>63.554169</td>
      <td>61.858921</td>
      <td>61.137474</td>
      <td>58.990791</td>
      <td>57.845352</td>
      <td>56.919193</td>
      <td>54.903385</td>
      <td>49.544353</td>
      <td>21.029455</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1036</th>
      <td>479</td>
      <td>7</td>
      <td>0.113494</td>
      <td>0.231745</td>
      <td>479.0</td>
      <td>0.241611</td>
      <td>0.295085</td>
      <td>0.048849</td>
      <td>1.088158e-01</td>
      <td>0.048849</td>
      <td>...</td>
      <td>46.354168</td>
      <td>45.673882</td>
      <td>48.411533</td>
      <td>50.850323</td>
      <td>49.939007</td>
      <td>50.334820</td>
      <td>53.680527</td>
      <td>54.955494</td>
      <td>14.586534</td>
      <td>6.322968</td>
    </tr>
    <tr>
      <th>1037</th>
      <td>559</td>
      <td>12</td>
      <td>0.024577</td>
      <td>0.149273</td>
      <td>559.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>...</td>
      <td>32.479515</td>
      <td>31.651064</td>
      <td>34.973198</td>
      <td>33.868011</td>
      <td>30.716120</td>
      <td>32.950115</td>
      <td>35.551098</td>
      <td>33.183990</td>
      <td>19.681183</td>
      <td>19.681183</td>
    </tr>
    <tr>
      <th>1038</th>
      <td>192</td>
      <td>12</td>
      <td>0.220913</td>
      <td>0.105247</td>
      <td>192.0</td>
      <td>0.123610</td>
      <td>0.000000</td>
      <td>0.048840</td>
      <td>0.000000e+00</td>
      <td>-0.048840</td>
      <td>...</td>
      <td>40.492584</td>
      <td>39.876831</td>
      <td>39.611507</td>
      <td>41.885006</td>
      <td>39.956230</td>
      <td>40.707684</td>
      <td>42.663235</td>
      <td>41.398083</td>
      <td>11.777842</td>
      <td>11.777842</td>
    </tr>
    <tr>
      <th>1039</th>
      <td>830</td>
      <td>9</td>
      <td>0.086527</td>
      <td>0.605671</td>
      <td>830.0</td>
      <td>0.511784</td>
      <td>0.826863</td>
      <td>0.192000</td>
      <td>3.529735e-01</td>
      <td>0.192000</td>
      <td>...</td>
      <td>34.992752</td>
      <td>32.145615</td>
      <td>32.896919</td>
      <td>31.653013</td>
      <td>28.286510</td>
      <td>27.994188</td>
      <td>28.999868</td>
      <td>26.611483</td>
      <td>14.960922</td>
      <td>11.412651</td>
    </tr>
    <tr>
      <th>1040</th>
      <td>449</td>
      <td>9</td>
      <td>0.220793</td>
      <td>0.602391</td>
      <td>449.0</td>
      <td>0.223083</td>
      <td>0.309762</td>
      <td>0.075286</td>
      <td>1.083945e-01</td>
      <td>0.013947</td>
      <td>...</td>
      <td>44.659206</td>
      <td>45.715481</td>
      <td>47.148674</td>
      <td>49.237782</td>
      <td>50.512478</td>
      <td>51.285664</td>
      <td>53.192677</td>
      <td>55.205410</td>
      <td>5.065959</td>
      <td>5.065959</td>
    </tr>
  </tbody>
</table>
<p>1041 rows × 1068 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import matplotlib as mpl</span>
<span class="c1"># def get_n_cmap_rgba(n, cmap):</span>
<span class="c1">#     num_colors = n+1</span>
<span class="c1">#     cm = mpl.cm.get_cmap(name=cmap)</span>
<span class="c1">#     currentColors = [cm(1.*i/num_colors) for i in range(num_colors)]#[1:]</span>
<span class="c1">#     return currentColors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># group_colors = {</span>
<span class="c1">#     &quot;Delta&quot; : dict(zip(fine_group_order, get_n_cmap_rgba(3, &quot;Blues&quot;))),</span>
<span class="c1">#     &quot;BA2&quot; : dict(zip(fine_group_order, get_n_cmap_rgba(3, &quot;RdPu&quot;)))</span>
<span class="c1"># }</span>
<span class="c1"># group_colors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">saveas</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;structural_statistics_</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">])</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    bbbBBB</span>
<span class="sd">    cccCCC</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="c1">#     height_ratios = [],</span>
<span class="c1">#     width_ratios = [],</span>
<span class="c1">#     empty_sentinel=&quot;.&quot;,</span>
    <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span>
<span class="c1">#         &quot;wspace&quot;: 0.20,</span>
        <span class="s2">&quot;hspace&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1">##################</span>
<span class="c1"># STRUCTURE IMAGES</span>
<span class="c1">##################</span>

<span class="c1"># axs[&quot;a&quot;].axis(&quot;off&quot;)</span>
<span class="c1"># protein_image = Image.open(&quot;../data/delta_structure.jpg&quot;)</span>
<span class="c1"># axs[&quot;a&quot;].imshow(protein_image)</span>

<span class="c1"># axs[&quot;A&quot;].axis(&quot;off&quot;)</span>
<span class="c1"># protein_image = Image.open(&quot;../data/protein_structure.jpg&quot;)</span>
<span class="c1"># axs[&quot;A&quot;].imshow(protein_image)</span>


<span class="c1">###############</span>
<span class="c1"># MAX V nbr MAX</span>
<span class="c1">###############</span>

<span class="k">for</span> <span class="n">homolog</span><span class="p">,</span> <span class="n">iter_ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;Delta&quot;</span><span class="p">,</span> <span class="s2">&quot;BA2&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]):</span>
    

<span class="c1">#     ax = sns.boxplot(</span>
<span class="c1">#         x=f&quot;nbr_{metric_prefix}_{homolog}&quot;, </span>
<span class="c1">#         y=f&#39;fine_group_{homolog}&#39;,</span>
<span class="c1">#         data=nbr_score_df,</span>
<span class="c1">#         order=fine_group_order,</span>
<span class="c1">#         ax=axs[iter_ax],</span>
<span class="c1">#         showfliers=False,</span>
<span class="c1">#         orient=&quot;h&quot;,</span>
<span class="c1">#         color=&#39;0.75&#39;,</span>
<span class="c1">#         width=0.75</span>
<span class="c1">#     )</span>
<span class="c1">#     sns.stripplot(</span>
<span class="c1"># #         x=f&quot;nbr_max_abs_S_{homolog}&quot;, </span>
<span class="c1">#         x=f&quot;nbr_{metric_prefix}_{homolog}&quot;, </span>
<span class="c1">#         y=f&#39;fine_group_{homolog}&#39;,</span>
<span class="c1">#         data=nbr_score_df,</span>
<span class="c1">#         order=fine_group_order,</span>
<span class="c1">#         ax=axs[iter_ax],</span>
<span class="c1">#         orient=&quot;h&quot;,</span>
<span class="c1">#         palette=group_colors[homolog],  # &#39;royalblue&#39; if homolog == &quot;Delta&quot; else &quot;magenta&quot;,</span>
<span class="c1">#         alpha=0.75,</span>
<span class="c1">#         size=2,</span>
<span class="c1">#         edgecolor=&quot;k&quot;,</span>
<span class="c1">#         linewidth=0.5</span>
<span class="c1">#     )</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">nbr_score_df</span><span class="p">,</span>
        <span class="n">y</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">x</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;nbr_</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">],</span>
        <span class="n">scatter_kws</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s1">&#39;royalblue&#39;</span> <span class="k">if</span> <span class="n">homolog</span> <span class="o">==</span> <span class="s2">&quot;Delta&quot;</span> <span class="k">else</span> <span class="s2">&quot;magenta&quot;</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
<span class="c1">#             &quot;edgecolor&quot;:&quot;k&quot;,</span>
<span class="c1">#             &quot;linewidth&quot;:2</span>
        <span class="p">}</span>
    <span class="p">)</span>

    
    <span class="n">corr</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span>
        <span class="n">nbr_score_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;nbr_</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> 
        <span class="n">nbr_score_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p=</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;p&lt;0.001&quot;</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;$r = </span><span class="si">{</span><span class="n">corr</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">$,</span><span class="se">\n</span><span class="s2">$</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> 
        <span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> 
        <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span> 
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span>
    <span class="p">)</span>
    

    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.52</span><span class="p">])</span>
<span class="c1">#     axs[iter_ax].set_xlim([-0.2, 1.52])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">homolog</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">homolog</span> <span class="o">==</span> <span class="s2">&quot;Delta&quot;</span> <span class="k">else</span> <span class="s2">&quot;BA.2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">homolog</span> <span class="o">==</span> <span class="s2">&quot;Delta&quot;</span><span class="p">:</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">averaged across neighboring sites&#39;</span>
<span class="c1">#         xlabel=f&#39;Mean. abs. shift \naveraged across neighboring sites&#39;</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;max. abs. shift </span><span class="se">\n</span><span class="s1">averaged across neighboring sites&#39;</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">.33</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;max. abs. shift&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="c1">#         axs[iter_ax].set_ylabel(&quot;Max. abs. shift&quot;, size=8)</span>
<span class="c1">#         axs[iter_ax].set_ylabel(metric_prefix, size=8)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    

    
<span class="c1">#     pairs=[(&quot;0.0-0.1&quot;, &quot;&gt;0.5&quot;)]</span>

<span class="c1">#     annotator = Annotator(</span>
<span class="c1">#         ax,</span>
<span class="c1">#         pairs,</span>
<span class="c1"># #         x=f&quot;nbr_max_abs_S_{homolog}&quot;, </span>
<span class="c1">#         x=f&quot;nbr_{metric_prefix}_{homolog}&quot;, </span>
<span class="c1">#         y=f&#39;fine_group_{homolog}&#39;,</span>
<span class="c1">#         data=nbr_score_df,</span>
<span class="c1">#         order=fine_group_order,</span>
<span class="c1">#         orient=&quot;h&quot;</span>
<span class="c1">#     )</span>
<span class="c1">#     annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
<span class="c1">#     annotator.apply_and_annotate()</span>


<span class="c1">###############</span>
<span class="c1"># MAX V nbr MAX</span>
<span class="c1">###############</span>



<span class="k">for</span> <span class="n">homolog</span><span class="p">,</span> <span class="n">iter_ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;Delta&quot;</span><span class="p">,</span> <span class="s2">&quot;BA2&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]):</span>
    

<span class="c1">#     ax = sns.boxplot(</span>
<span class="c1">#         x=f&quot;dist_nearest_{homolog}_nis&quot;, </span>
<span class="c1">#         y=f&#39;fine_group_{homolog}&#39;,</span>
<span class="c1">#         data=nbr_score_df.query(f&quot;dist_nearest_{homolog}_nis != 0&quot;),</span>
<span class="c1">#         order=fine_group_order,</span>
<span class="c1">#         ax=axs[iter_ax],</span>
<span class="c1">#         showfliers=False,</span>
<span class="c1">#         orient=&quot;h&quot;,</span>
<span class="c1">#         color=&#39;0.75&#39;,</span>
<span class="c1">#         width=0.75</span>
<span class="c1">#     )</span>
<span class="c1">#     sns.stripplot(</span>
<span class="c1">#         x=f&quot;dist_nearest_{homolog}_nis&quot;, </span>
<span class="c1">#         y=f&#39;fine_group_{homolog}&#39;,</span>
<span class="c1">#         data=nbr_score_df.query(f&quot;dist_nearest_{homolog}_nis != 0&quot;),</span>
<span class="c1">#         order=fine_group_order,</span>
<span class="c1">#         ax=axs[iter_ax],</span>
<span class="c1">#         orient=&quot;h&quot;,</span>
<span class="c1"># #         color=&#39;royalblue&#39; if homolog == &quot;Delta&quot; else &quot;magenta&quot;,</span>
<span class="c1">#         palette=group_colors[homolog],  # &#39;royalblue&#39; if homolog == &quot;Delta&quot; else &quot;magenta&quot;,</span>
<span class="c1">#         alpha=0.75,</span>
<span class="c1">#         size=2,</span>
<span class="c1">#         edgecolor=&quot;k&quot;,</span>
<span class="c1">#         linewidth=0.5</span>
<span class="c1">#     )</span>

<span class="c1">#     scatter_kws[&quot;c&quot;] = &#39;royalblue&#39; if homolog == &quot;Delta&quot; else &quot;magenta&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">nbr_score_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis != 0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">upper</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
<span class="c1">#         c=&#39;royalblue&#39; if homolog == &quot;Delta&quot; else &quot;magenta&quot;,</span>
        <span class="n">y</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">x</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">],</span>
<span class="c1">#         scatter_kws = scatter_kws</span>
        <span class="n">scatter_kws</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s1">&#39;royalblue&#39;</span> <span class="k">if</span> <span class="n">homolog</span> <span class="o">==</span> <span class="s2">&quot;Delta&quot;</span> <span class="k">else</span> <span class="s2">&quot;magenta&quot;</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
<span class="c1">#             &quot;edgecolor&quot;:&quot;k&quot;,</span>
<span class="c1">#             &quot;linewidth&quot;:2</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">corr</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span>
        <span class="n">nbr_score_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis != 0&quot;</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis&quot;</span><span class="p">],</span> 
        <span class="n">nbr_score_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis != 0&quot;</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p=</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;p&lt;0.001&quot;</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;$r=</span><span class="si">{</span><span class="n">corr</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">$,</span><span class="se">\n</span><span class="s2">$</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> 
        <span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
        <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span> 
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span>
    <span class="p">)</span>



    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">55</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
    
    
    <span class="k">if</span> <span class="n">homolog</span> <span class="o">==</span> <span class="s2">&quot;Delta&quot;</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;distance to nearest non-identical site ($\AA$)&#39;</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">.31</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">metric_prefix</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;max. abs. shift&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="c1">#         axs[iter_ax].set_ylabel(&quot;Mean. abs. shift&quot;, size=8)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">iter_ax</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
<span class="c1">#     pairs=[(&quot;0.0-0.1&quot;, &quot;&gt;0.5&quot;)]</span>
<span class="c1"># #     pairs=[(&quot;0.0-0.5&quot;, &quot;&gt;1.0&quot;)]</span>

<span class="c1">#     annotator = Annotator(</span>
<span class="c1">#         ax,</span>
<span class="c1">#         pairs,</span>
<span class="c1">#         x=f&quot;dist_nearest_{homolog}_nis&quot;, </span>
<span class="c1"># #         x=f&quot;nbr_max_abs_S_{homolog}&quot;, </span>
<span class="c1">#         y=f&#39;fine_group_{homolog}&#39;,</span>
<span class="c1">#         data=nbr_score_df.query(f&quot;dist_nearest_{homolog}_nis != 0&quot;),</span>
<span class="c1">#         order=fine_group_order,</span>
<span class="c1">#         orient=&quot;h&quot;</span>
<span class="c1">#     )</span>
<span class="c1">#     annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
<span class="c1">#     annotator.apply_and_annotate()</span>

    
<span class="c1">###########################</span>
<span class="c1"># NIS V I Site distribution</span>
<span class="c1">###########################</span>


<span class="c1"># for homolog, iter_ax in zip([&quot;Delta&quot;, &quot;BA2&quot;], [&quot;d&quot;, &quot;D&quot;]):</span>
    
<span class="c1">#     ax = sns.boxplot(</span>
<span class="c1">#         y=f&quot;is_{homolog}_nis&quot;, </span>
<span class="c1">#         x=f&quot;{metric_prefix}_{homolog}&quot;,</span>
<span class="c1"># #         x=f&quot;n_nbrs&quot;,</span>
<span class="c1">#         data=nbr_score_df,</span>
<span class="c1">#         order=[False, True],</span>
<span class="c1">#         ax=axs[iter_ax], </span>
<span class="c1">#         showfliers=False,</span>
<span class="c1">#         width=0.75,</span>
<span class="c1">#         orient=&quot;h&quot;,</span>
<span class="c1">#         color=&#39;0.75&#39;</span>
<span class="c1">#     )</span>
<span class="c1">#     sns.stripplot(</span>
<span class="c1">#         y=f&quot;is_{homolog}_nis&quot;, </span>
<span class="c1">#         x=f&quot;{metric_prefix}_{homolog}&quot;,</span>
<span class="c1"># #         x=f&quot;n_nbrs&quot;,</span>
<span class="c1">#         data=nbr_score_df,</span>
<span class="c1">#         order=[False, True],</span>
<span class="c1">#         ax=axs[iter_ax],</span>
<span class="c1">#         orient=&quot;h&quot;,</span>
<span class="c1">#         color=&quot;0.5&quot;, #&#39;royalblue&#39; if homolog == &quot;Delta&quot; else &quot;magenta&quot;,</span>
<span class="c1">#         alpha=0.75,</span>
<span class="c1">#         size=2,</span>
<span class="c1">#         edgecolor=&quot;k&quot;,</span>
<span class="c1">#         linewidth=0.5</span>
<span class="c1"># #         marker=&quot;o&quot;</span>
<span class="c1">#     )</span>
    
<span class="c1">#     axs[iter_ax].set_xlim([-0.2, 2.2])</span>
<span class="c1">#     axs[iter_ax].set_xticks([0, 1, 2], labels = [0, 1, 2])</span>

<span class="c1">#     if homolog == &quot;Delta&quot;:</span>
<span class="c1">#         axs[iter_ax].set_yticklabels([&quot;identical\nsites&quot;, &quot;non-\nidentical\nsites&quot;], size=10)</span>
<span class="c1">#         xlabel=f&#39;max abs. shift at site&#39;</span>
<span class="c1"># #         xlabel=f&#39;Mean abs. shift at site&#39;</span>
<span class="c1"># #         xlabel=metric_prefix</span>
<span class="c1"># #         xlabel=&quot;# nbrs&quot;</span>
<span class="c1">#         axs[iter_ax].set_xlabel(xlabel)</span>
<span class="c1">#         axs[iter_ax].xaxis.set_label_coords(1.0, -.33)</span>
<span class="c1">#     else:</span>
<span class="c1">#         axs[iter_ax].set_yticklabels([])</span>
<span class="c1">#         axs[iter_ax].set_xlabel(None)</span>
<span class="c1">#     axs[iter_ax].set_ylabel(None)           </span>
<span class="c1">#     sns.despine(ax=axs[iter_ax])</span>
<span class="c1">#     axs[iter_ax].grid()</span>
<span class="c1">#     pairs=[(False, True)]</span>

<span class="c1">#     annotator = Annotator(</span>
<span class="c1">#         ax,</span>
<span class="c1">#         pairs,</span>
<span class="c1">#         y=f&quot;is_{homolog}_nis&quot;, </span>
<span class="c1">#         x=f&quot;{metric_prefix}_{homolog}&quot;,</span>
<span class="c1"># #         x=f&quot;max_abs_S_{homolog}&quot;,</span>
<span class="c1">#         data=nbr_score_df,</span>
<span class="c1">#         order=[False, True],</span>
<span class="c1">#         orient=&quot;h&quot;</span>
<span class="c1">#     )</span>
<span class="c1">#     annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
<span class="c1"># #     annotator.configure(test=&#39;Mann-Whitney&#39;, text_format=&#39;star&#39;, loc=&#39;inside&#39;)</span>
<span class="c1"># #     annotator.configure(test=&#39;Mann-Whitney&#39;,  loc=&#39;inside&#39;)</span>
<span class="c1">#     annotator.apply_and_annotate()</span>

    
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FIG_OUTDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">saveas</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FIG_OUTDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">saveas</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c031aaaaa83df59a45bf16b30f6b981981bb29b1705e6db8035e9a1775a21ec3.png" src="_images/c031aaaaa83df59a45bf16b30f6b981981bb29b1705e6db8035e9a1775a21ec3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">homolog</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;Delta&quot;</span><span class="p">,</span> <span class="s2">&quot;BA2&quot;</span><span class="p">]):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">nbr_score_df</span><span class="p">,</span>
        <span class="n">x</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">y</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;nbr_</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f7cfc3ef930b5eff236cc2e2c445ac6d3baeaf5cde1226d8991092d5414a2acf.png" src="_images/f7cfc3ef930b5eff236cc2e2c445ac6d3baeaf5cde1226d8991092d5414a2acf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">homolog</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;Delta&quot;</span><span class="p">,</span> <span class="s2">&quot;BA2&quot;</span><span class="p">]):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">nbr_score_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis != 0&quot;</span><span class="p">),</span>
        <span class="n">x</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">y</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dist_nearest_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">scatter_kws</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s1">&#39;royalblue&#39;</span> <span class="k">if</span> <span class="n">homolog</span> <span class="o">==</span> <span class="s2">&quot;Delta&quot;</span> <span class="k">else</span> <span class="s2">&quot;magenta&quot;</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span><span class="mi">80</span><span class="p">,</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;edgecolor&quot;</span><span class="p">:</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span><span class="mi">2</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/87e26c0593a6229a587e01929c7bf97454fb43d86cf363d24d81a2b483dd8729.png" src="_images/87e26c0593a6229a587e01929c7bf97454fb43d86cf363d24d81a2b483dd8729.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mut_df_replicates</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wts</th>
      <th>sites</th>
      <th>muts</th>
      <th>0_beta</th>
      <th>1_beta</th>
      <th>avg_beta</th>
      <th>0_S_Delta</th>
      <th>1_S_Delta</th>
      <th>avg_S_Delta</th>
      <th>0_S_BA2</th>
      <th>1_S_BA2</th>
      <th>avg_S_BA2</th>
    </tr>
    <tr>
      <th>mutation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A1015D</th>
      <td>A</td>
      <td>1015.0</td>
      <td>D</td>
      <td>-1.240629</td>
      <td>-2.365959</td>
      <td>-1.803294</td>
      <td>0.030702</td>
      <td>0.000000</td>
      <td>0.015351</td>
      <td>-0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>A1015S</th>
      <td>A</td>
      <td>1015.0</td>
      <td>S</td>
      <td>-0.194236</td>
      <td>-0.136035</td>
      <td>-0.165136</td>
      <td>-0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>-0.000037</td>
      <td>-0.000018</td>
    </tr>
    <tr>
      <th>A1015T</th>
      <td>A</td>
      <td>1015.0</td>
      <td>T</td>
      <td>-1.828467</td>
      <td>-1.701370</td>
      <td>-1.764919</td>
      <td>0.000000</td>
      <td>1.490752</td>
      <td>0.745376</td>
      <td>-0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>A1015V</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-4.209478</td>
      <td>-4.209478</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>A1016D</th>
      <td>A</td>
      <td>1016.0</td>
      <td>D</td>
      <td>-0.807699</td>
      <td>NaN</td>
      <td>-0.807699</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Y917F</th>
      <td>Y</td>
      <td>917.0</td>
      <td>F</td>
      <td>-0.292854</td>
      <td>-0.220422</td>
      <td>-0.256638</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Y917H</th>
      <td>Y</td>
      <td>917.0</td>
      <td>H</td>
      <td>-3.455611</td>
      <td>-2.315981</td>
      <td>-2.885796</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Y917N</th>
      <td>Y</td>
      <td>917.0</td>
      <td>N</td>
      <td>-2.435212</td>
      <td>NaN</td>
      <td>-2.435212</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Y91C</th>
      <td>Y</td>
      <td>91.0</td>
      <td>C</td>
      <td>-2.280230</td>
      <td>-2.743021</td>
      <td>-2.511626</td>
      <td>-0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Y91H</th>
      <td>Y</td>
      <td>91.0</td>
      <td>H</td>
      <td>-4.802296</td>
      <td>-3.860295</td>
      <td>-4.331295</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>6926 rows × 12 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vc</span> <span class="o">=</span> <span class="n">mut_df_replicates</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">vc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;sites&quot;</span><span class="p">:</span><span class="n">vc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;n_muts_at_site&quot;</span><span class="p">:</span><span class="n">vc</span><span class="o">.</span><span class="n">values</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sites&quot;</span><span class="p">)</span>
<span class="n">vc_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_muts_at_site</th>
    </tr>
    <tr>
      <th>sites</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>253.0</th>
      <td>21</td>
    </tr>
    <tr>
      <th>76.0</th>
      <td>21</td>
    </tr>
    <tr>
      <th>19.0</th>
      <td>21</td>
    </tr>
    <tr>
      <th>1228.0</th>
      <td>21</td>
    </tr>
    <tr>
      <th>75.0</th>
      <td>21</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>993.0</th>
      <td>1</td>
    </tr>
    <tr>
      <th>997.0</th>
      <td>1</td>
    </tr>
    <tr>
      <th>338.0</th>
      <td>1</td>
    </tr>
    <tr>
      <th>342.0</th>
      <td>1</td>
    </tr>
    <tr>
      <th>720.0</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>1235 rows × 1 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_nis</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()[[</span><span class="s2">&quot;sites&quot;</span><span class="p">,</span> <span class="s2">&quot;is_Delta_nis&quot;</span><span class="p">,</span> <span class="s2">&quot;is_BA2_nis&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;sites&quot;</span><span class="p">)</span>
<span class="n">is_nis</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>is_Delta_nis</th>
      <th>is_BA2_nis</th>
    </tr>
    <tr>
      <th>sites</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>27.0</th>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>28.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>29.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>30.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>31.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1143.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1144.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1145.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1146.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1147.0</th>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>1041 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">is_nis</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">vc_df</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>is_Delta_nis</th>
      <th>is_BA2_nis</th>
      <th>n_muts_at_site</th>
    </tr>
    <tr>
      <th>sites</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>27.0</th>
      <td>False</td>
      <td>True</td>
      <td>8</td>
    </tr>
    <tr>
      <th>28.0</th>
      <td>False</td>
      <td>False</td>
      <td>5</td>
    </tr>
    <tr>
      <th>29.0</th>
      <td>False</td>
      <td>False</td>
      <td>20</td>
    </tr>
    <tr>
      <th>30.0</th>
      <td>False</td>
      <td>False</td>
      <td>8</td>
    </tr>
    <tr>
      <th>31.0</th>
      <td>False</td>
      <td>False</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1143.0</th>
      <td>False</td>
      <td>False</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1144.0</th>
      <td>False</td>
      <td>False</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1145.0</th>
      <td>False</td>
      <td>False</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1146.0</th>
      <td>False</td>
      <td>False</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1147.0</th>
      <td>False</td>
      <td>False</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
<p>1041 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">homolog</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;Delta&quot;</span><span class="p">,</span> <span class="s2">&quot;BA2&quot;</span><span class="p">]):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;n_muts_at_site&quot;</span><span class="p">,</span>
        <span class="n">y</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;is_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis&quot;</span><span class="p">,</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
        <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span>
    <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;n_muts_at_site&quot;</span><span class="p">,</span>
        <span class="n">y</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;is_</span><span class="si">{</span><span class="n">homolog</span><span class="si">}</span><span class="s2">_nis&quot;</span><span class="p">,</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
        <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/154bb3f1241529e14f16f0b9604744036210a7ba640fe0c82a838ed93eaa71ef.png" src="_images/154bb3f1241529e14f16f0b9604744036210a7ba640fe0c82a838ed93eaa71ef.png" />
</div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Joint Modeling of SARS-CoV-2 Spike homologs</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spike-analysis.html">Spike Analysis</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Jared Galloway.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/spike-structure-analysis.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>